<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="tomorrow-night.css" />
    <link rel="stylesheet" type="text/css" href="tooltipster.css" />
</head>

<body>

<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="prettify.js"></script>
<script type="text/javascript" src="tooltipster.js"></script>
<script type="text/javascript" src="codecode.js"></script>

<div class="codeTop">
	<div class="codeLeft">// Code for the extended Assignment #3 <a href="https://github.com/FKuhlewind/Portofolio1/blob/gh-pages/code-asg3.js" target="_blank">(code-asg3.js)</a></div>
	<div class="codeRight">
		<div class="codeButton1"><div class="dIn"><a href="https://gist.github.com/FKuhlewind/9724093" target="_blank">Initial Assignment</a></div></div>
		<div class="codeButton2"><div class="dIn">Enable Tooltips</div></div>
	</div>
</div>

<pre><code class="prettyprint">$(document).ready(function() { 

// check localStorage and choose font accordingly
$('body, #onRight').css({'font-family':localStorage.myFont});
$("#background").css({'background-color':localStorage.myColor+'0.2)'});
$("button").css({'background-color':localStorage.myColor+'0.6)'});

<span class="yell" title="The following three objects store different mockJSON templates which I have created so the script can be tested with a bigger variation of values.">eventsTemplate1</span> = {
    		"events|5-20":[{
      		"name|1-2": "@LOREM ",
      		"rating|1-7": 0,
      		"ficticious|0-1": true, }]
  		};
eventsTemplate2 = {
    		"events|10-25":[{
      		"name|1-3": "@LOREM ",
      		"rating|<span class="yell" title="Right, I wanted to see what it looks like if the input values differ more.">0-100</span>": 0,
      		"ficticious|0-1": true, }]
  		};
eventsTemplate3 = {
    		"events|2-15":[{
      		"name|2-4": "@LOREM ",
      		"rating|1-3": 0,
      		"ficticious|0-1": true, }]
  		};
  		
<span class="yell" title="On load, the template will be set to the initial template as provided for the assignment.">eventsTemplate = eventsTemplate1;</span> 

createData = function () {
  	<span class="yell" title="A new object is created by calling the mockJSON function which generates a random object based on the given template...">var events = $.mockJSON.generateFromTemplate(eventsTemplate);</span>
  	var eventsJSON = JSON.stringify(events);  
  	<span class="yell" title="...and then the object is turned into a string and saved in localStorage for later usage (code copied from the AST page.)">localStorage.setItem("assignment", eventsJSON);</span>
  	
  	myObject = JSON.parse(localStorage.assignment);
	xMax = d3.max(myObject.events, function(d) { return d.rating;}); // get highest value
	<span class="yell" title="We need both the highest value and the total number of values to define the display range of our diagram.">yMax = myObject.events.length;</span> // get number of values
	};

<span class="yell" title="This function creates the SVG.">createSVG = function ()</span> {

	<span class="yell" title="We need to define the scale functions first:"></span>// create scale functions
	var xScale = d3.scale.linear()
    		.domain([0, xMax])
    		<span class="yell" title="For the x scale, the domain is defined by the min/max values and mapped onto a range equal to the size of the diagram (minus padding),...">.range([padding, width-(padding*2)]);</span>
	var yScale = d3.scale.ordinal()
    		.domain(d3.range(yMax))
    		<span class="yell" title="...and for the y scale, domain is defined by ordinal values based on the amount of values, again mapped onto the diagrams total size.">.rangeRoundBands([height-padding, padding], 0.1);</span>
	
	// define X axis
	<span class="yell" title="This defines the x axis using the above scale function."> var xAxis = d3.svg.axis()</span> 
    		.scale(xScale)
    		.orient("bottom")
    		<span class="yell" title="Teh x axis should be placed at the bottom and the number of ticks should be about five.">.ticks(xMax/(xMax/5));</span>

	// create svg 
	var mySVG = d3.select(".here")
	 	<span class="yell" title="Appends the SVG at the correct location and applies widh and height.">.append("svg")</span> 
	 	.attr("width", width)
    		.attr("height", height);
	   	
    	// define color from localStorage	
    	<span class="yell" title="Correct color can only be applied once the SVG is there (see #1).">$("svg").css({'background-color':localStorage.myColor+'0.3)'});</span>
    	
	// create bars
	<span class="yell" title="Now things become interesting: Select all rectangles (Which ones?)...">mySVG.selectAll("rect")</span>
    		.data(myObject.events)
    		.enter()
    		<span class="yell" title="...bind them to the data and let them .enter the stage (Now they are there.)">.append("rect")</span>
    		.attr("y", function(d, i) {
                 	return yScale(i);})
    		.attr("x", function(d) {
            		return xScale(0);})
    		<span class="yell" title="Attributes are applied to each rectangle based on the bound data and scale functions.">.attr("height", yScale.rangeBand())</span>
    		.attr("width", function(d) {
                 	return xScale(d.rating)-padding;})
    		.style("fill", function (d) {
            		<span class="yell" title="If the event is fictitious, color it orange, otherwise make it green.">if (!d.ficticious) {return "#8f9d45"}</span> 
            		else {return "#E89E0C"} ;});   
	
	// add labels
	mySVG.selectAll("text")
   		.data(myObject.events)
   		.enter()
		<span class="yell" title="Now add a text element to the SVG for each value...">.append("text")</span>
   		.text ( function name(d) {
  			return d.name;
			})
    		<span class="yell" title="...and position it on its repsective bar,">.attr("y", function(d, i)</span>  {
                 	return yScale(i) + yScale.rangeBand() / 2;})
    		.attr("x", function(d) {
            		return xScale(0)<span class="yell" title="(only a little bit to the right)">+10</span>;})
    		.attr("alignment-baseline" , "middle")
    		.style({'fill': 'black','font-family':'Arial'})
		.style("font-size", function(d) { 
			if (yMax < 11) { return "18px" }
			<span class="yell" title="...and make the font size dependant on the number of events so that it always fits.">else { return yScale.rangeBand()-3+"px" }</span>
			});
    	
	//create X axis
	<span class="yell" title="This adds the x axis to our diagram.">mySVG.append("g")</span>
    		.attr("transform", "translate(0," + (height - padding) + ")")
    		.style({ 'stroke': 'Black', 'fill': 'none', 'stroke-width': '1.5px',/
    			'font-family':'Arial', 'font-size':'12px'})
    		<span class="yell" title="After style and position have been defined, the axis gets created by callind the axis' function."> .call(xAxis);</span>
	};

<span class="yell" title="So this is where the actual script starts: First basic values such as size and padding are defined,..."> var width = 540;</span> 
var height = 360;
var padding = 30;

<span class="yell" title="... then the data gets generated via mockJSON and the SVG is created.">createData();</span> 
createSVG();
 <!-- <span class="yell" title="">       </span>   -->
<span class="yell" title="With the click of a button...">$("#newData").on("click", function ()</span> {
	eventsTemplate = eventsTemplate1;
	$("svg").remove();
	createData();
	createSVG();
	});
$("#newData2").on("click", function () {
	<span class="yell" title="...the chosen template will be selected...">eventsTemplate = eventsTemplate2;</span>
	$("svg").remove();
	createData();
	<span class="yell" title="...and the SVG gets replaced with a new one containing fresh data.">createSVG();</span>
	});
$("#newData3").on("click", function () {
	eventsTemplate = eventsTemplate3;
	$("svg").remove();
	createData();
	createSVG();
	});
});
</code></pre>
</body>
</html>
