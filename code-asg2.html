<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="tomorrow-night.css" />
    <link rel="stylesheet" type="text/css" href="tooltipster.css" />
</head>

<body>

<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="prettify.js"></script>
<script type="text/javascript" src="tooltipster.js"></script>
<script type="text/javascript" src="codecode.js"></script>

<div class="codeTop">
	<div class="codeLeft">// Code for the extended Assignment #2 <a href="https://github.com/FKuhlewind/Portofolio1/blob/gh-pages/code-asg2.js" target="_blank">(code-asg2.js)</a>, Handlebars template below</div>
	<div class="codeRight">
		<div class="codeButton1"><div class="dIn"><a href="https://gist.github.com/FKuhlewind/9723598" target="_blank">Initial Assignment</a></div></div>
		<div class="codeButton2"><div class="dIn">Enable Tooltips</div></div>
	</div>
</div>


<pre><code class="prettyprint">$(document).ready(function() { 

// check localStorage and choose font accordingly
$('body, #onRight').css({'font-family':localStorage.myFont});

<span class="yell" title="Set a pointer to the location in Firebase where the data is stored.">myDataRef = new Firebase('https://student-data.firebaseio.com/');</span> 

<span class="yell" title="This function hides the input elements that should not be seen initially.">function hideInput</span> () {
	$('tr td:last-child, tbody tr:last-child, #hide, .newS, #saveStud, .saveChange').hide();
	$("#addStudent").css({"background-color":localStorage.myColor+"0)"});
	};

// create template and hide input

<span class="yell" title="Load the student data from Firebase and execute the following code once the data has been loaded.">d3.json('https://student-data.firebaseio.com/.json', function(data)</span> {
	studentData = data;
	<span class="yell" title="Count the number of students saved in Firebase...">appNum = data.students.length;</span> 
	
	<span class="yell" title="...and as a security measure filter out all empty elements.">studentData.students = studentData.students.filter(function(e){return e});</span> 

    	<span class="yell" title="Reference the template script...">studentTemplateScript</span> = $("#students-template").html();
    	theStudentTemplate = <span class="yell" title="...and compile it.">Handlebars.compile(studentTemplateScript);</span>
  
    	// append the table
    	<span class="yell" title="Then, append the table filled with student data to the correct location...">$(".here").append(theStudentTemplate(studentData));</span> 
 	
    	// assign styling from localStorage
    	<span class="yell" title="...and apply the correct styling according to localStorage, ...">$("table#hand, table#hand tr").css({'background-color':localStorage.myColor+'0.2)'});</span>
	$("table#hand th").css({'background-color':localStorage.myColor+'0.3)'});
	$("button").css({'background-color':localStorage.myColor+'0.6)'});

	<span class="yell" title="...and hide the input elements.">hideInput();</span>

	<span class="yell" title="If the 'edit' button gets clicked, enlarge the last column with toggleClass and show the buttons that enable editing, removing and adding a student.">$("thead")</span>.on("click", <span class="yell" title="Event delegation is extremely important here as the table get created anew later and otherwise the events would not be bound to the target elements anymore.">"#edit"</span>, function(e) {
		$('tr th:last-child').toggleClass('lastColLong lastColShort');
		$("#addStud, tr td:last-child, tbody tr:last-child, #hide").show();
		$("#edit, .saveChange").hide();
		});

	$("thead").on("click", "#hide", function(e){
		<span class="yell" title="When the user clicks the 'cancel' button, the page is forced to reload and this way jumps back to its initial state. This may not be the most elegant solution, but it was the simplest way to reload or update the table. Using iFrames makes this approach possible.">window.location.reload();</span> 
		});
<!--   <span class="yell" title="">   </span>    -->   
	$("tbody").on("click", "td#addSave", function(e) {
		$('#addStud, .editStud, .delete ').hide();
		$('#saveStud').show();
		$('.newS').show();
		$("#addStudent").css({"background-color":localStorage.myColor+"0.2)"});
		e.preventDefault();
		});

	$("tbody").on("click", "#saveStud", function(e) {
		myDataRef.child("students").child(appNum).child("first").set( $("#firstin").val() );
		myDataRef.child("students").child(appNum).child("last").set( $("#lastin").val() );
		myDataRef.child("students").child(appNum).child("email").set( $("#emailin").val() );
		myDataRef.child("students").child(appNum).child("uvaID").set( $("#uvaIDin").val() );
		window.location.reload();
		alert ("Student added successfully.");
		});

	$("tbody").on("click", ".delete", function(e) {
		studentData.students.splice(  $(this).val(),1 );
		myDataRef.set( studentData );
		window.location.reload();
		alert ("Student removed.");
		});

	$("tbody").on("click", ".editStud", function(e) {

		var vl = $(this).val();

		$(".editStud, .delete, #addStudent").hide();
		$("#edit"+vl).show();

		$("tr#stud"+vl).children(".inf1")
			.replaceWith("&lttd>&ltinput type='text' id='nFirst' value='"+studentData.students[vl].first+"'/></td>");
		$("tr#stud"+vl).children(".inf2")
			.replaceWith("&lttd>&ltinput type='text' id='nLast' value='"+studentData.students[vl].last+"'/></td>");
		$("tr#stud"+vl).children(".inf4")
			.replaceWith("&lttd>&ltinput type='text' id='nEmail' value='"+studentData.students[vl].email+"'/></td>"); 

		$("#edit"+vl).on("click", function(e) {

			studentData.students[vl].first = $("#nFirst").val();
			studentData.students[vl].last = $("#nLast").val();
			studentData.students[vl].email = $("#nEmail").val();

			myDataRef.set( studentData );
			window.location.reload();
			alert ("Your changes have been saved.");
			});
		});
	});	
});
<div class="codeTop">
   <div class="codeLeft">// The Handlebars template as used in the page for this assignment <a href="https://github.com/FKuhlewind/Portofolio1/blob/gh-pages/page-asg2.html" target="_blank" class="codelink">(page-asg2.html)</a></div>
</div>
&ltscript id="students-template" type="text/x-handlebars-template">
  &lttable id="hand">
    &ltthead>
      &ltth>First</th>
      &ltth>Last</th>
      &ltth>UvA ID</th>
      &ltth>Email</th>
      &ltth class="lastColShort" id="showHide">
      	&ltbutton id="edit">Edit</button>
      	&ltbutton id="hide">Cancel</button>
      </th>
    </thead>
    &lttbody>
      {{#students}}
        &lttr id="stud{{@index}}">
          &lttd class="inf1"> {{first}} </td>
          &lttd class="inf2"> {{last}}  </td>
          &lttd class="inf3"> {{uvaID}} </td>
          &lttd class="inf4"> {{email}} </td>
          &lttd class="lastColShort"> 
            &ltbutton  class="editStud" value="{{@index}}">Edit</button>
            &ltbutton class="delete" value="{{@index}}">Del.</button>
            &ltbutton id="edit{{@index}}" class="saveChange">Save</button>
          </td>
        </tr>
      {{/students}}
        &lttr id="addStudent">
        &ltform class="newS" id="newStud">
          &lttd><input type="text" id="firstin" class="newS"/></td>
          &lttd><input type="text" id="lastin" class="newS"/></td>
          &lttd><input type="text" id="uvaIDin" class="newS"/></td>
          &lttd><input type="text" id="emailin" class="newS"/></td>
          &lttd id="addSave">
            &ltbutton id="addStud">Add Student</button>
            &ltbutton id="saveStud">Save</button>
          </td>
        </form>
        </tr>
    </tbody>
  </table>
</script>
</code></pre>
</body>
</html>
